<span class="Comment">% Define the graph simulation problem.</span>
<span class="Statement">Kind</span> action     <span class="Type">type</span><span class="Special">.</span>
<span class="Statement">Type</span> a<span class="Special">,</span>b<span class="Special">,</span>c      action<span class="Special">.</span>
<span class="Statement">Type</span> action_w   action <span class="Special">-&gt;</span> i<span class="Special">.</span>
<span class="Statement">Type</span> proc_w     <span class="Type">nat</span> <span class="Special">-&gt;</span> i<span class="Special">.</span>
<span class="Statement">Type</span> step_w     i <span class="Special">-&gt;</span> i <span class="Special">-&gt;</span> i <span class="Special">-&gt;</span> i<span class="Special">.</span>


<span class="Statement">Define</span> step <span class="Special">:</span> <span class="Statement">(</span>i <span class="Special">-&gt;</span> bool<span class="Statement">)</span> <span class="Special">-&gt;</span> <span class="Type">prop</span> <span class="Statement">by</span>
  step <span class="Statement">(</span>mu1 one<span class="Statement">\</span>x<span class="Statement">\</span>
      <span class="Statement">(</span>oplus <span class="Statement">(</span>eq x <span class="Statement">(</span>step_w <span class="Statement">(</span>proc_w <span class="Number">1</span><span class="Statement">)</span> <span class="Statement">(</span>action_w a<span class="Statement">)</span> <span class="Statement">(</span>proc_w <span class="Number">2</span><span class="Statement">)))</span>
      <span class="Statement">(</span>oplus <span class="Statement">(</span>eq x <span class="Statement">(</span>step_w <span class="Statement">(</span>proc_w <span class="Number">1</span><span class="Statement">)</span> <span class="Statement">(</span>action_w a<span class="Statement">)</span> <span class="Statement">(</span>proc_w <span class="Number">3</span><span class="Statement">)))</span>
      <span class="Statement">(</span>oplus <span class="Statement">(</span>eq x <span class="Statement">(</span>step_w <span class="Statement">(</span>proc_w <span class="Number">2</span><span class="Statement">)</span> <span class="Statement">(</span>action_w b<span class="Statement">)</span> <span class="Statement">(</span>proc_w <span class="Number">4</span><span class="Statement">)))</span>
      <span class="Statement">(</span>oplus <span class="Statement">(</span>eq x <span class="Statement">(</span>step_w <span class="Statement">(</span>proc_w <span class="Number">3</span><span class="Statement">)</span> <span class="Statement">(</span>action_w c<span class="Statement">)</span> <span class="Statement">(</span>proc_w <span class="Number">5</span><span class="Statement">)))</span>
      <span class="Statement">(</span>oplus <span class="Statement">(</span>eq x <span class="Statement">(</span>step_w <span class="Statement">(</span>proc_w <span class="Number">6</span><span class="Statement">)</span> <span class="Statement">(</span>action_w a<span class="Statement">)</span> <span class="Statement">(</span>proc_w <span class="Number">7</span><span class="Statement">)))</span>
      <span class="Statement">(</span>oplus <span class="Statement">(</span>eq x <span class="Statement">(</span>step_w <span class="Statement">(</span>proc_w <span class="Number">7</span><span class="Statement">)</span> <span class="Statement">(</span>action_w b<span class="Statement">)</span> <span class="Statement">(</span>proc_w <span class="Number">8</span><span class="Statement">)))</span>
             <span class="Statement">(</span>eq x <span class="Statement">(</span>step_w <span class="Statement">(</span>proc_w <span class="Number">7</span><span class="Statement">)</span> <span class="Statement">(</span>action_w c<span class="Statement">)</span> <span class="Statement">(</span>proc_w <span class="Number">9</span><span class="Statement">)))</span>
      <span class="Statement">)))))))</span><span class="Special">.</span>

<span class="Comment">% Proper path (transitive closure of adj, doesn't assume reflexivity)</span>
<span class="Statement">Define</span> sim <span class="Special">:</span> <span class="Statement">(</span>i <span class="Special">-&gt;</span> i <span class="Special">-&gt;</span> bool<span class="Statement">)</span> <span class="Special">-&gt;</span> <span class="Type">prop</span> <span class="Statement">by</span>
  sim <span class="Statement">(</span>nu2 sim<span class="Statement">\</span>p<span class="Statement">\</span>q<span class="Statement">\</span> all a<span class="Statement">\</span> all p'<span class="Statement">\</span> <span class="Statement">(</span>imp <span class="Statement">(</span><span class="Identifier">Step</span> <span class="Statement">(</span>step_w p a p'<span class="Statement">))</span> <span class="Statement">(</span>some q'<span class="Statement">\</span> <span class="Statement">(</span>oplus <span class="Statement">(</span><span class="Identifier">Step</span> <span class="Statement">(</span>step_w q a q'<span class="Statement">))</span> <span class="Statement">(</span>sim p' q'<span class="Statement">)))))</span> <span class="Special">:=</span>
    step <span class="Identifier">Step</span><span class="Special">.</span>

<span class="Comment">%% Improper path (transitive-reflexive closure, includes the diagonal)</span>
<span class="Comment">%Define ipath : (i -&gt; i -&gt; bool) -&gt; prop by</span>
<span class="Comment">%  ipath (mu2 path\x\y\ (oplus (eq x y) (some z\ (tensor (Adj x z) (path z y))))) := adj Adj.</span>
