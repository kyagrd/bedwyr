#!/bin/bash
#
# finds the best way to invoke the tool

if command -v @PACKAGE_TARNAME@.native >/dev/null 2>&1 ; then
  PROGRAM=@PACKAGE_TARNAME@.native
else
  if command -v @PACKAGE_TARNAME@.byte >/dev/null 2>&1 ; then
    PROGRAM=@PACKAGE_TARNAME@.byte
  else
    echo >&2 "@PACKAGE_TARNAME@ doesn't seem to be installed"
    exit 1
  fi
fi

WORDS="+pkgdatadir+/contrib/rlwrap/completions"
if [ -f "$WORDS" ] ; then
  AUTOCOMPLETION="-b(){}[],%\";. -f$WORDS"
else
  AUTOCOMPLETION="-b(){}[],%\";"
fi

if command -v rlwrap >/dev/null 2>&1 ; then
  WRAPPER="rlwrap -c -C@PACKAGE_TARNAME@ -D2 -g'^(n|y)$' -m -pgreen -q'\"' $AUTOCOMPLETION"
else
  WRAPPER=""
fi

if command -v tput >/dev/null 2>&1 ; then
  if [ -n "${TERM}" ] ; then
    COLUMNS=`tput cols`
    COLORS=`tput colors`
  fi
fi

exec -a @PACKAGE_TARNAME@ $WRAPPER env COLUMNS="${COLUMNS}" COLORS="${COLORS}" $PROGRAM "$@"
